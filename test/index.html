<!doctype html>
<title>Tubes.js test page</title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="../build/tubes.js"></script>
<script>
	var xhr;
	var banner = function(str){
		console.log("================================");
		console.log(str);
		console.log("================================");
		console.log("");
	};
	banner("Tubes.js Browser Test")
	var Tube = new Tubes({});
	var Queue = new Tubes({maxCalls:1});
	var url = "http://gdata.youtube.com/feeds/api/videos?&orderby=published&author=GoogleDevelopers&alt=json&max-results=50&callback=?";
	var handle = function(e){
		console.log(e);
	};
	var startPause = function(){
		var pipe = Tube.pipe({
			url : url,
			dataType : "json",
			success : handle,
			error : handle
		}, {});
		var pipe2 = Tube.pipe({
			url : url,
			dataType : "json",
			success : handle,
			error : handle
		}, {});
		banner("Pausing Tube");
		Tube.pause();

		var last = Tube.pipe({
			url : url,
			dataType : "json",
			success : handle,
			error : handle
		}, {});

		setTimeout(function(){
			banner("Resuming Tube");
			Tube.resume();
		},5000);

		pipe.on("done", function(){
			banner("Pipe1 clean");
		});

		pipe2.on("done", function(){
			banner("Pipe2 clean");
		});

		last.on("done", function(){
			banner("Last pipe clean");
			banner("Starting Queue");
			startQueue();
		});
	};
	var startQueue = function(){
		var queue1 = Queue.pipe({
			url : url,
			dataType : "json",
			success : handle,
			error : handle
		}, {});
		var queue2 = Queue.pipe({
			url : url,
			dataType : "json",
			success : handle,
			error : handle
		}, {});
		var queue3 = Queue.pipe({
			url : url,
			dataType : "json",
			success : handle,
			error : handle
		}, {});
		var queue4 = Queue.pipe({
			url : url,
			dataType : "json",
			success : handle,
			error : handle
		}, {});
		banner("Pausing Queue");
		Tube.pause();
		var queueLast = Queue.pipe({
			url : url,
			dataType : "json",
			success : handle,
			error : handle
		}, {});

		banner("Resuming Queue");
		Tube.resume();

		queue1.on("done", function(){
			banner("Queue 1 done");
		})
		queue2.on("done", function(){
			banner("Queue 2 done");
		})
		queue3.on("done", function(){
			banner("Queue 3 done");
		})
		queue4.on("done", function(){
			banner("Queue 4 done");
		})

		queueLast.on("done", function(){
			banner("Queue Finished");
			banner("Test Finished");
		})

	};
	var startTest = function(){
		banner("Starting pause resume test");
		startPause();
	};


	startTest();

</script>